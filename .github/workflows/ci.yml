name: iOS CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: macos-14 # or macos-13 for older Xcode

    steps:
    - name: Checkout source
      uses: actions/checkout@v3

    - name: Set up Xcode
      run: sudo xcode-select -s /Applications/Xcode_26.0.app # adjust to your Xcode version

    - name: Resolve Swift Package dependencies
      run: xcodebuild -resolvePackageDependencies -project iStocks.xcodeproj

    - name: Build and Test
      run: |
        xcodebuild \
          -project iStocks.xcodeproj \
          -scheme iStocks \
          -destination 'platform=iOS Simulator,name=iPhone 16,OS=18.2' \
          clean build test \
          CODE_SIGNING_ALLOWED=NO
